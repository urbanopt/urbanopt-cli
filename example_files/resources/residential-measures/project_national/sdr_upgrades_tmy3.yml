schema_version: '0.6'
os_version: 3.10.0
os_sha: 86d7e215a1
buildstock_directory: ../ # Relative to this file or absolute
project_directory: project_national # Relative to buildstock_directory
output_directory: sdr_upgrades_tmy3
weather_files_url: https://data.nrel.gov/system/files/156/Buildstock_TMY3_FIPS-1678817889.zip
# weather_files_path: c:/OpenStudio/BuildStock_TMY3_FIPS.zip # Local weather files example
# weather_files_path: /kfs2/shared-projects/buildstock/weather/BuildStock_TMY3_FIPS.zip # Kestrel TMY3 weather files
# weather_files_path: /kfs2/shared-projects/buildstock/weather/BuildStock_2018_FIPS.zip # Kestrel 2018 weather files

# Baseline number of units
baseline:
  n_buildings_represented: 139647020 # American Community Survey 2021 5-year, B25001, does not include territories

# Sampler type and number of data points per baseline or upgrade
sampler:
  type: precomputed
  # type: residential_quota # For production run
  args:
    sample_file: resources/sdr_minimal_buildstock.csv # For CI
    # n_datapoints: 550000 # For production run

# NREL High Performance Computing machine configuration
# Not used if running buildstock_local (local tests and CI)
kestrel:
  n_jobs: 600
  minutes_per_sim: 10
  account: <account>
  postprocessing:
    time: 800
    n_workers: 20
    n_procs: 20
  sampling:
    time: 60

# Timeout to avoid whole-job failures from long-running models
max_minutes_per_sim: 5

# Post proccessing and Amazon Web Services
postprocessing:
  # Post simulation partitioning
  keep_individual_timeseries: true
  partition_columns:
    - State
    - County
  publish_annual_results: true
  # AWS upload bucket and athena setup (uncomment during production and testing runs)
  aws:
   region_name: us-west-2
   s3:
     bucket: resstock-core
     prefix: resstock_ci
   athena:
     glue_service_role: service-role/AWSGlueServiceRole-default
     database_name: resstock_core
     max_crawling_time: 1200

# Workflow generator
workflow_generator:
  # ResStock HPXML workflow generator
  type: residential_hpxml
  version: 2025.04.29

  args:
    # Annual simulation and timestep
    build_existing_model:
      simulation_control_timestep: 15
      simulation_control_run_period_begin_month: 1
      simulation_control_run_period_begin_day_of_month: 1
      simulation_control_run_period_end_month: 12
      simulation_control_run_period_end_day_of_month: 31
      simulation_control_run_period_calendar_year: 2018
      add_component_loads: true

    # Emissions scenarios
    emissions:
      - scenario_name: AER_HighRECost_Avg
        type: CO2e
        elec_folder: data/emissions/cambium/2024/AER_HighRECost_Avg
      - scenario_name: AER_HighRECostLowNGPrice_Avg
        type: CO2e
        elec_folder: data/emissions/cambium/2024/AER_HighRECostLowNGPrice_Avg
      - scenario_name: AER_LowRECost_Avg
        type: CO2e
        elec_folder: data/emissions/cambium/2024/AER_LowRECost_Avg
      - scenario_name: AER_LowRECostHighNGPrice_Avg
        type: CO2e
        elec_folder: data/emissions/cambium/2024/AER_LowRECostHighNGPrice_Avg
      - scenario_name: AER_MidCase_Avg
        type: CO2e
        elec_folder: data/emissions/cambium/2024/AER_MidCase_Avg
      - scenario_name: LRMER_HighRECost_15
        type: CO2e
        elec_folder: data/emissions/cambium/2024/LRMER_HighRECost_15
      - scenario_name: LRMER_HighRECost_25
        type: CO2e
        elec_folder: data/emissions/cambium/2024/LRMER_HighRECost_25
      - scenario_name: LRMER_HighRECostLowNGPrice_15
        type: CO2e
        elec_folder: data/emissions/cambium/2024/LRMER_HighRECostLowNGPrice_15
      - scenario_name: LRMER_HighRECostLowNGPrice_25
        type: CO2e
        elec_folder: data/emissions/cambium/2024/LRMER_HighRECostLowNGPrice_25
      - scenario_name: LRMER_LowRECost_15
        type: CO2e
        elec_folder: data/emissions/cambium/2024/LRMER_LowRECost_15
      - scenario_name: LRMER_LowRECost_25
        type: CO2e
        elec_folder: data/emissions/cambium/2024/LRMER_LowRECost_25
      - scenario_name: LRMER_LowRECostHighNGPrice_15
        type: CO2e
        elec_folder: data/emissions/cambium/2024/LRMER_LowRECostHighNGPrice_15
      - scenario_name: LRMER_LowRECostHighNGPrice_25
        type: CO2e
        elec_folder: data/emissions/cambium/2024/LRMER_LowRECostHighNGPrice_25
      - scenario_name: LRMER_MidCase_15
        type: CO2e
        elec_folder: data/emissions/cambium/2024/LRMER_MidCase_15
      - scenario_name: LRMER_MidCase_25
        type: CO2e
        elec_folder: data/emissions/cambium/2024/LRMER_MidCase_25

    # Utility bill rates
    utility_bills:
      - scenario_name: Utility Rates - Fixed + Variable
        simple_filepath: data/utility_bills/sdr_rates/State.tsv

    # Outputs to include
    simulation_output_report:
      timeseries_frequency: timestep
      include_timeseries_total_consumptions: true
      include_timeseries_fuel_consumptions: true
      include_timeseries_end_use_consumptions: true
      include_timeseries_emissions: true
      include_timeseries_emission_fuels: true
      include_timeseries_emission_end_uses: false
      include_timeseries_hot_water_uses: true
      include_timeseries_total_loads: true
      include_timeseries_component_loads: true
      include_timeseries_unmet_hours: true
      include_timeseries_zone_temperatures: true
      include_timeseries_zone_conditions: true
      include_timeseries_airflows: true
      include_timeseries_weather: true
      include_timeseries_resilience: true
      output_variables:
        - name: People Sensible Heating Rate
        - name: People Total Heating Rate
        - name: Site Outdoor Air Humidity Ratio

    # Other reporting measures to run
    reporting_measures:
      - measure_dir_name: QOIReport
      - measure_dir_name: ServerDirectoryCleanup # tack this on so we can save some disk space (when using debug: true)

    # Files to keep
    server_directory_cleanup:
      retain_in_idf: true
      retain_schedules_csv: true
      retain_in_osm: true

    debug: true

references:
  ### -- Anchors not dependent on other anchors -- ###
  attic_insulation_cz1_sf: &attic_insulation_cz1_sf
    option: Insulation Ceiling|R-49
    apply_logic:
      - or:
        - ASHRAE IECC Climate Zone 2004|1A
      - or:
        - Geometry Attic Type|Vented Attic
        - Geometry Attic Type|Unvented Attic
      - or:
        - Insulation Ceiling|Uninsulated
        - Insulation Ceiling|R-7
        - Insulation Ceiling|R-13
        - Insulation Ceiling|R-19
        - Insulation Ceiling|R-30
        - Insulation Ceiling|R-38

  attic_insulation_cz2_8_sf: &attic_insulation_cz2_8_sf
    option: Insulation Ceiling|R-60
    apply_logic:
      - not: ASHRAE IECC Climate Zone 2004|1A
      - or:
        - Geometry Attic Type|Vented Attic
        - Geometry Attic Type|Unvented Attic
      - or:
        - Insulation Ceiling|Uninsulated
        - Insulation Ceiling|R-7
        - Insulation Ceiling|R-13
        - Insulation Ceiling|R-19
        - Insulation Ceiling|R-30
        - Insulation Ceiling|R-38
        - Insulation Ceiling|R-49

  #Air sealing / infiltration reduction
  infiltration_all_cz_sf_mf_mb: &infiltration_all_cz_sf_mf_mb
    option: Infiltration|5 ACH50
    apply_logic:
      - or:
          - Infiltration|6 ACH50
          - Infiltration|7 ACH50
          - Infiltration|8 ACH50
          - Infiltration|10 ACH50
          - Infiltration|15 ACH50
          - Infiltration|20 ACH50
          - Infiltration|25 ACH50
          - Infiltration|30 ACH50
          - Infiltration|40 ACH50
          - Infiltration|50 ACH50

  duct_seal_only_r6: &duct_seal_only_r6
    option: Duct Leakage and Insulation|5% Leakage to Outside, R-6
    apply_logic:
      - or:
        - Duct Leakage and Insulation|10% Leakage to Outside, R-6
        - Duct Leakage and Insulation|20% Leakage to Outside, R-6
        - Duct Leakage and Insulation|30% Leakage to Outside, R-6

  duct_seal_only_r8: &duct_seal_only_r8
    option: Duct Leakage and Insulation|5% Leakage to Outside, R-8
    apply_logic:
      - or:
        - Duct Leakage and Insulation|10% Leakage to Outside, R-8
        - Duct Leakage and Insulation|20% Leakage to Outside, R-8
        - Duct Leakage and Insulation|30% Leakage to Outside, R-8

  duct_seal_and_insulate: &duct_seal_and_insulate
    option: Duct Leakage and Insulation|5% Leakage to Outside, R-8
    apply_logic:
      - or:
        - Duct Leakage and Insulation|10% Leakage to Outside, R-4
        - Duct Leakage and Insulation|10% Leakage to Outside, Uninsulated
        - Duct Leakage and Insulation|20% Leakage to Outside, R-4
        - Duct Leakage and Insulation|20% Leakage to Outside, Uninsulated
        - Duct Leakage and Insulation|30% Leakage to Outside, R-4
        - Duct Leakage and Insulation|30% Leakage to Outside, Uninsulated

  drill_and_fill_wall_insulation: &drill_and_fill_wall_insulation
    option: Insulation Wall|Wood Stud, R-13
    apply_logic:
      - Insulation Wall|Wood Stud, Uninsulated

  infiltration_30pct_reduction_windows: &infiltration_30pct_reduction_windows
    option: Infiltration Reduction|30%
    apply_logic:
      - or:
        - Windows|Single, Clear, Metal
        - Windows|Single, Clear, Metal, Exterior Clear Storm
        - Windows|Single, Clear, Non-metal
        - Windows|Single, Clear, Non-metal, Exterior Clear Storm

  infiltration_13pct_reduction_windows: &infiltration_13pct_reduction_windows
    option: Infiltration Reduction|13%
    apply_logic:
      - or:
        - Windows|Double, Clear, Metal, Air
        - Windows|Double, Clear, Metal, Air, Exterior Clear Storm
        - Windows|Double, Clear, Non-metal, Air
        - Windows|Double, Clear, Non-metal, Air, Exterior Clear Storm
        - Windows|Double, Low-E, Non-metal, Air, M-Gain
        - Windows|Triple, Low-E, Non-metal, Air, L-Gain

  energystar_window_northern: &energystar_window_northern
    option: Windows|EnergyStar, Northern
    apply_logic:
      - Energystar Climate Zone 2023|Northern

  energystar_window_north_central: &energystar_window_north_central
    option: Windows|EnergyStar, North-Central
    apply_logic:
      - Energystar Climate Zone 2023|North-Central

  energystar_window_south_central: &energystar_window_south_central
    option: Windows|EnergyStar, South-Central
    apply_logic:
      - Energystar Climate Zone 2023|South-Central

  energystar_window_southern: &energystar_window_southern
    option: Windows|EnergyStar, Southern
    apply_logic:
      - Energystar Climate Zone 2023|Southern
      - not: Windows|Triple, Low-E, Non-metal, Air, L-Gain

  demand_flexibility_30_minute_random_shift: &demand_flexibility_30_minute_random_shift
    option: Demand Flexibility Random Shift|30 minutes

  demand_flexibility_electric_vehicle: &demand_flexibility_electric_vehicle
    option: Demand Flexibility Electric Vehicle|Enabled

  ducted_ashp_apply_logic: &ducted_ashp_apply_logic
    - HVAC Has Ducts|Yes
    - not:
      - or:
        - HVAC Shared Efficiencies|Boiler Baseboards Heating Only, Electricity
        - HVAC Shared Efficiencies|Boiler Baseboards Heating Only, Fuel
        - HVAC Shared Efficiencies|Fan Coil Heating and Cooling, Electricity
        - HVAC Shared Efficiencies|Fan Coil Heating and Cooling, Fuel
        - HVAC Shared Efficiencies|Fan Coil Cooling Only

  ev_15_percent_efficiency: &ev_15_percent_efficiency
    option: Electric Vehicle Efficiency Increase|15%

  ev_l2_charger: &ev_l2_charger
    option: Electric Vehicle Charger|Level 2 charger

  ev_ownership_yes: &ev_ownership_yes
    option: Electric Vehicle Ownership|Yes

  has_cooling_or_heating: &has_cooling_or_heating
    - or:
      - not: HVAC Cooling Type|None
      - not: HVAC Heating Type|None

  remove_heating_shared_other_wood: &remove_heating_shared_other_wood
    - HVAC Has Ducts|Yes
    - not: Heating Fuel|Wood
    - not: Heating Fuel|Other Fuel
    - not: Heating Fuel|None
    - not:
      - or:
        - HVAC Shared Efficiencies|Boiler Baseboards Heating Only, Electricity
        - HVAC Shared Efficiencies|Boiler Baseboards Heating Only, Fuel
        - HVAC Shared Efficiencies|Fan Coil Heating and Cooling, Electricity
        - HVAC Shared Efficiencies|Fan Coil Heating and Cooling, Fuel
        - HVAC Shared Efficiencies|Fan Coil Cooling Only

  occupied_only: &occupied_only
    Vacancy Status|Occupied

  partial_conditioning_100_percent_ducts_only: &partial_conditioning_100_percent_ducts_only
    option: HVAC Cooling Partial Space Conditioning|100% Conditioned
    apply_logic:
      - HVAC Has Ducts|Yes

  remove_high_rise_shared: &remove_high_rise_shared
    - not: Heating Fuel|Wood
    - not: Heating Fuel|Other Fuel
    - not: Heating Fuel|None
    - not:
      - or:
        - HVAC Shared Efficiencies|Boiler Baseboards Heating Only, Electricity
        - HVAC Shared Efficiencies|Boiler Baseboards Heating Only, Fuel
        - HVAC Shared Efficiencies|Fan Coil Heating and Cooling, Electricity
        - HVAC Shared Efficiencies|Fan Coil Heating and Cooling, Fuel
        - HVAC Shared Efficiencies|Fan Coil Cooling Only
      - and:
        - Geometry Building Type Height|Multi-Family with 5+ Units, 8+ Stories

  remove_nonducted_high_rise_shared: &remove_nonducted_high_rise_shared
    - HVAC Has Ducts|Yes
    - not: Heating Fuel|Wood
    - not: Heating Fuel|Other Fuel
    - not: Heating Fuel|None
    - not:
      - or:
        - HVAC Shared Efficiencies|Boiler Baseboards Heating Only, Electricity
        - HVAC Shared Efficiencies|Boiler Baseboards Heating Only, Fuel
        - HVAC Shared Efficiencies|Fan Coil Heating and Cooling, Electricity
        - HVAC Shared Efficiencies|Fan Coil Heating and Cooling, Fuel
        - HVAC Shared Efficiencies|Fan Coil Cooling Only
      - and:
        - Geometry Building Type Height|Multi-Family with 5+ Units, 8+ Stories

  # FIXME: We'd prefer to apply GHP to 0.5 and 0.8, but we are actively working on fixing a bug here.
  # When fixed, remove the following block and replace with use of remove_nonducted_high_rise_shared.
  remove_nonducted_high_rise_shared_low_ground_conductivity: &remove_nonducted_high_rise_shared_low_ground_conductivity
    - HVAC Has Ducts|Yes
    - not: Heating Fuel|Wood
    - not: Heating Fuel|Other Fuel
    - not: Heating Fuel|None
    - not:
      - or:
        - HVAC Shared Efficiencies|Boiler Baseboards Heating Only, Electricity
        - HVAC Shared Efficiencies|Boiler Baseboards Heating Only, Fuel
        - HVAC Shared Efficiencies|Fan Coil Heating and Cooling, Electricity
        - HVAC Shared Efficiencies|Fan Coil Heating and Cooling, Fuel
        - HVAC Shared Efficiencies|Fan Coil Cooling Only
      - and:
        - Geometry Building Type Height|Multi-Family with 5+ Units, 8+ Stories
    - not:
      - or:
        - Ground Thermal Conductivity|0.5
        - Ground Thermal Conductivity|0.8

  yes_and_no_has_ducts_apply_logic: &yes_and_no_has_ducts_apply_logic
    - or:
      - HVAC Has Ducts|Yes
      - HVAC Has Ducts|No

  hpwh_apply_logic: &hpwh_apply_logic
    # remove dwelling units that have hpwh or solar thermal water heater
    - not: Water Heater Efficiency|Electric Heat Pump, 50 gal, 3.45 UEF
    - not: Water Heater Efficiency|Electric Heat Pump, 66 gal, 3.35 UEF
    - not: Water Heater Efficiency|Electric Heat Pump, 80 gal, 3.45 UEF
    - not: Water Heater Fuel|Solar Thermal
    - not: Water Heater Fuel|Other Fuel
    - not: Water Heater Fuel|Wood

  high_eff_ng_tankless_wh_apply_logic: &high_eff_ng_tankless_wh_apply_logic
    # remove dwelling units that have hpwh or solar thermal wh or tankless gas wh
    # have access to natural gas
    - not: Water Heater Efficiency|Electric Heat Pump, 50 gal, 3.45 UEF
    - not: Water Heater Efficiency|Electric Heat Pump, 66 gal, 3.35 UEF
    - not: Water Heater Efficiency|Electric Heat Pump, 80 gal, 3.45 UEF
    - not: Water Heater Fuel|Solar Thermal
    - not: Water Heater Fuel|Other Fuel
    - not: Water Heater Fuel|Wood
    - not: Water Heater Efficiency|Natural Gas Tankless
    - or:
      - Water Heater Fuel|Natural Gas
      - Heating Fuel|Natural Gas
      - HVAC Secondary Heating Fuel|Natural Gas
      - Clothes Dryer|Gas
      - Cooking Range|Gas
      - Misc Pool Heater|Natural Gas
      - Misc Hot Tub Spa|Natural Gas

  change_water_heater_fuel_to_electricity: &change_water_heater_fuel_to_electricity
    option: Water Heater Fuel|Electricity
    apply_logic:
      - not: Water Heater Fuel|Electricity

  change_water_heater_fuel_to_natural_gas: &change_water_heater_fuel_to_natural_gas
    option: Water Heater Fuel|Natural Gas
    apply_logic:
      - not: Water Heater Fuel|Natural Gas

  hpwh_50_gal_3_pt_78_uef: &hpwh_50_gal_3_pt_78_uef
    option: Water Heater Efficiency|Electric Heat Pump, 50 gal, 3.78 UEF
    apply_logic:
      - or:
        - Bedrooms|1
        - Bedrooms|2
      - or:
        - Occupants|0
        - Occupants|1
        - Occupants|2
        - Occupants|3

  hpwh_66_gal_3_pt_95_uef: &hpwh_66_gal_3_pt_95_uef
    option: Water Heater Efficiency|Electric Heat Pump, 66 gal, 3.95 UEF
    apply_logic:
      - or:
        - and:
          - or:
            - Bedrooms|1
            - Bedrooms|2
          - Occupants|4
        - and:
          - Bedrooms|3
          - or:
            - Occupants|0
            - Occupants|1
            - Occupants|2
            - Occupants|3
            - Occupants|4

  hpwh_80_gal_3_pt_98_uef: &hpwh_80_gal_3_pt_98_uef
    option: Water Heater Efficiency|Electric Heat Pump, 80 gal, 3.98 UEF
    apply_logic:
      - or:
        - Bedrooms|4
        - Bedrooms|5
        - Occupants|5
        - Occupants|6
        - Occupants|7
        - Occupants|8
        - Occupants|9
        - Occupants|10+

  high_eff_ng_tankless_wh: &high_eff_ng_tankless_wh
    option: Water Heater Efficiency|High Efficiency Natural Gas Tankless, Condensing

  ### -- Anchors dependent on other anchors -- ###
  cooling_setpoint_no_offset: &cooling_setpoint_no_offset
      option: Cooling Setpoint Has Offset|No
      apply_logic: *yes_and_no_has_ducts_apply_logic

  cooling_setpoint_offset_magnitude_0: &cooling_setpoint_offset_magnitude_0
      option: Cooling Setpoint Offset Magnitude|0F
      apply_logic: *yes_and_no_has_ducts_apply_logic

  cooling_setpoint_offset_period_none: &cooling_setpoint_offset_period_none
      option: Cooling Setpoint Offset Period|None
      apply_logic: *yes_and_no_has_ducts_apply_logic

  ducted_ashp_seer_20_11_hspf_cchp_electric_backup: &ducted_ashp_seer_20_11_hspf_cchp_electric_backup
      option: HVAC Heating Efficiency|ASHP, SEER 20, 11 HSPF, CCHP, Max Load
      apply_logic: *ducted_ashp_apply_logic

  dual_speed_ducted_ghp: &dual_speed_ducted_ghp
      option: HVAC Heating Efficiency|GSHP, EER 20.5, COP 4.0
      apply_logic: *ducted_ashp_apply_logic

  heat_pump_cooling_efficiency_ducted: &heat_pump_cooling_efficiency_ducted
      option: HVAC Cooling Efficiency|Ducted Heat Pump
      apply_logic: *ducted_ashp_apply_logic

  heating_setpoint_no_offset: &heating_setpoint_no_offset
      option: Heating Setpoint Has Offset|No
      apply_logic: *yes_and_no_has_ducts_apply_logic

  heating_setpoint_offset_magnitude_0: &heating_setpoint_offset_magnitude_0
      option: Heating Setpoint Offset Magnitude|0F
      apply_logic: *yes_and_no_has_ducts_apply_logic

  heating_setpoint_offset_period_none: &heating_setpoint_offset_period_none
      option: Heating Setpoint Offset Period|None
      apply_logic: *yes_and_no_has_ducts_apply_logic

  partial_conditioning_100_percent: &partial_conditioning_100_percent
      option: HVAC Cooling Partial Space Conditioning|100% Conditioned
      apply_logic: *yes_and_no_has_ducts_apply_logic

  fossil_fuel_or_electricity: &fossil_fuel_or_electricity
    - not: Heating Fuel|Wood
    - not: Heating Fuel|Other Fuel
    - not: Heating Fuel|None

  cchp_apply_logic: &typical_cold_climate_logic
    - HVAC Has Ducts|Yes # apply to homes with ducts who have non-shared HVAC or shared HVAC with room for a condenser
    - or:
        - not:
          - or:
            - HVAC Shared Efficiencies|Boiler Baseboards Heating Only, Electricity
            - HVAC Shared Efficiencies|Boiler Baseboards Heating Only, Fuel
            - HVAC Shared Efficiencies|Fan Coil Heating and Cooling, Electricity
            - HVAC Shared Efficiencies|Fan Coil Heating and Cooling, Fuel
            - HVAC Shared Efficiencies|Fan Coil Cooling Only
        # - or:
        - and:
          - HVAC Cooling Type|Ducted Heat Pump
          - or:
            - Geometry Building Type ACS|10 to 19 Unit
            - Geometry Building Type ACS|2 Unit
            - Geometry Building Type ACS|20 to 49 Unit
            - Geometry Building Type ACS|3 or 4 Unit
            - Geometry Building Type ACS|5 to 9 Unit
            - Geometry Building Type ACS|50 or more Unit
        - and:
          - HVAC Cooling Type|Non-Ducted Heat Pump
          - or:
            - Geometry Building Type ACS|10 to 19 Unit
            - Geometry Building Type ACS|2 Unit
            - Geometry Building Type ACS|20 to 49 Unit
            - Geometry Building Type ACS|3 or 4 Unit
            - Geometry Building Type ACS|5 to 9 Unit
            - Geometry Building Type ACS|50 or more Unit
        - and:
          - HVAC Cooling Type|Central AC
          - not: HVAC Shared Efficiencies|Fan Coil Cooling Only
          - or:
            - Geometry Building Type ACS|10 to 19 Unit
            - Geometry Building Type ACS|2 Unit
            - Geometry Building Type ACS|20 to 49 Unit
            - Geometry Building Type ACS|3 or 4 Unit
            - Geometry Building Type ACS|5 to 9 Unit
            - Geometry Building Type ACS|50 or more Unit

  dual_fuel_cold_apply_logic: &dual_fuel_system_cold_climate
    - HVAC Has Ducts|Yes # apply to homes with ducts who have non-shared HVAC or shared HVAC with room for a condenser
    - not:
      - or:
        - HVAC Shared Efficiencies|Boiler Baseboards Heating Only, Electricity
        - HVAC Shared Efficiencies|Boiler Baseboards Heating Only, Fuel
        - HVAC Shared Efficiencies|Fan Coil Heating and Cooling, Electricity
        - HVAC Shared Efficiencies|Fan Coil Heating and Cooling, Fuel
        - HVAC Shared Efficiencies|Fan Coil Cooling Only
    - or:
      - ASHRAE IECC Climate Zone 2004|5A
      - ASHRAE IECC Climate Zone 2004|5B
      - ASHRAE IECC Climate Zone 2004|6A
      - ASHRAE IECC Climate Zone 2004|6B
      - ASHRAE IECC Climate Zone 2004|7A
      - ASHRAE IECC Climate Zone 2004|7B
      - ASHRAE IECC Climate Zone 2004|7AK
      - ASHRAE IECC Climate Zone 2004|8AK
    - or:
      - Heating Fuel|Natural Gas
      - Water Heater Fuel|Natural Gas
      - Clothes Dryer|Gas, Premium
      - Clothes Dryer|Gas
      - Cooking Range|Gas
      - HVAC Secondary Heating Fuel|Natural Gas
      - Misc Pool Heater|Natural Gas
      - Misc Hot Tub Spa|Natural Gas

  dual_fuel_warm_apply_logic: &dual_fuel_system_warm_climate
    - HVAC Has Ducts|Yes # apply to homes with ducts who have non-shared HVAC or shared HVAC with room for a condenser
    - not:
      - or:
        - HVAC Shared Efficiencies|Boiler Baseboards Heating Only, Electricity
        - HVAC Shared Efficiencies|Boiler Baseboards Heating Only, Fuel
        - HVAC Shared Efficiencies|Fan Coil Heating and Cooling, Electricity
        - HVAC Shared Efficiencies|Fan Coil Heating and Cooling, Fuel
        - HVAC Shared Efficiencies|Fan Coil Cooling Only
    - or:
        - ASHRAE IECC Climate Zone 2004|1A
        - ASHRAE IECC Climate Zone 2004|2A
        - ASHRAE IECC Climate Zone 2004|2B
        - ASHRAE IECC Climate Zone 2004|3A
        - ASHRAE IECC Climate Zone 2004|3B
        - ASHRAE IECC Climate Zone 2004|3C
        - ASHRAE IECC Climate Zone 2004|4A
        - ASHRAE IECC Climate Zone 2004|4B
        - ASHRAE IECC Climate Zone 2004|4C
    - or:
      - Heating Fuel|Natural Gas
      - Water Heater Fuel|Natural Gas
      - Clothes Dryer|Gas, Premium
      - Clothes Dryer|Gas
      - Cooking Range|Gas
      - HVAC Secondary Heating Fuel|Natural Gas
      - Misc Pool Heater|Natural Gas
      - Misc Hot Tub Spa|Natural Gas

### Standard Data Release - Residential -- ###
upgrades:
  ### -- HVAC: Furnaces -- ###
  - upgrade_name: Natural Gas Furnace 95% AFUE for All Dwellings with Ducts
    package_apply_logic: *remove_heating_shared_other_wood
    options:
        ### -- Natural Gas Furnace AFUE 95% applies to all dwellings with ducts
      - option: HVAC Heating Efficiency|Fuel Furnace, 95% AFUE
        # no apply logic on purpose since package_apply_logic handles it
      - option: HVAC Heating Type And Fuel|Natural Gas Fuel Furnace
        apply_logic:
          - not: HVAC Heating Type And Fuel|Natural Gas Fuel Furnace
      - option: Heating Fuel|Natural Gas
        apply_logic:
          - not: Heating Fuel|Natural Gas

  - upgrade_name: Propane Furnace 95% AFUE or Fuel Oil Furnace 88% AFUE
    package_apply_logic: *remove_heating_shared_other_wood
    options:
      - option: HVAC Heating Efficiency|Fuel Furnace, 95% AFUE
        apply_logic:
          - Heating Fuel|Propane
          - or:
            - HVAC Heating Efficiency|Fuel Furnace, 60% AFUE
            - HVAC Heating Efficiency|Fuel Furnace, 68% AFUE
            - HVAC Heating Efficiency|Fuel Furnace, 72% AFUE
            - HVAC Heating Efficiency|Fuel Furnace, 76% AFUE
            - HVAC Heating Efficiency|Fuel Furnace, 80% AFUE
            - HVAC Heating Efficiency|Fuel Furnace, 85% AFUE
            - HVAC Heating Efficiency|Fuel Furnace, 90% AFUE
            - HVAC Heating Efficiency|Fuel Furnace, 92.5% AFUE
      - option: HVAC Heating Efficiency|Fuel Furnace, 88% AFUE
        apply_logic:
          - Heating Fuel|Fuel Oil
          - or:
            - HVAC Heating Efficiency|Fuel Furnace, 60% AFUE
            - HVAC Heating Efficiency|Fuel Furnace, 68% AFUE
            - HVAC Heating Efficiency|Fuel Furnace, 72% AFUE
            - HVAC Heating Efficiency|Fuel Furnace, 76% AFUE
            - HVAC Heating Efficiency|Fuel Furnace, 80% AFUE
            - HVAC Heating Efficiency|Fuel Furnace, 85% AFUE

  - upgrade_name: Minimum Efficiency Furnaces and Air Conditioners Circa 2025
    package_apply_logic:
      and:
        - *fossil_fuel_or_electricity
        - *typical_cold_climate_logic
    options:
      ### [1] Heating Efficiencies
      ## 1.1 Replace like with like - retain applicability for costing purposing
      # electric heating
      - option: HVAC Heating Efficiency|Electric Furnace, 100% AFUE
        apply_logic:
          - HVAC Heating Efficiency|Electric Furnace, 100% AFUE

      - option: HVAC Heating Efficiency|Electric Boiler, 100% AFUE
        apply_logic:
          - HVAC Heating Efficiency|Electric Boiler, 100% AFUE

      - option: HVAC Heating Efficiency|Electric Baseboard, 100% Efficiency
        apply_logic:
          - HVAC Heating Efficiency|Electric Baseboard, 100% Efficiency

      - option: HVAC Heating Efficiency|Electric Wall Furnace, 100% AFUE
        apply_logic:
          - HVAC Heating Efficiency|Electric Wall Furnace, 100% AFUE

      # non-ducted fuel furnaces
      - option: HVAC Heating Efficiency|Fuel Wall/Floor Furnace, 60% AFUE
        apply_logic:
          - HVAC Heating Efficiency|Fuel Wall/Floor Furnace, 60% AFUE

      - option: HVAC Heating Efficiency|Fuel Wall/Floor Furnace, 68% AFUE
        apply_logic:
          - HVAC Heating Efficiency|Fuel Wall/Floor Furnace, 68% AFUE

      # MSHP (not applicable because of package_apply_logic)
      # - option: HVAC Heating Efficiency|MSHP, SEER 14.5, 8.2 HSPF
      #   apply_logic:
      #     - HVAC Heating Efficiency|MSHP, SEER 14.5, 8.2 HSPF

      # - option: HVAC Heating Efficiency|MSHP, SEER 29.3, 14 HSPF
      #   apply_logic:
      #     - HVAC Heating Efficiency|MSHP, SEER 29.3, 14 HSPF

      ## 1.2 Categories with efficiency change:
      # min. eff fuel boilers
      - option: HVAC Heating Efficiency|Fuel Boiler, 80% AFUE
        apply_logic:
          - or:
            - Heating Fuel|Natural Gas
            - Heating Fuel|Propane
          - or:
            - HVAC Heating Efficiency|Fuel Boiler, 76% AFUE
            - HVAC Heating Efficiency|Fuel Boiler, 80% AFUE

      - option: HVAC Heating Efficiency|Fuel Boiler, 83% AFUE
        apply_logic:
          - Heating Fuel|Fuel Oil
          - or:
            - HVAC Heating Efficiency|Fuel Boiler, 76% AFUE
            - HVAC Heating Efficiency|Fuel Boiler, 80% AFUE

      - option: HVAC Heating Efficiency|Fuel Boiler, 90% AFUE
        apply_logic:
          - HVAC Heating Efficiency|Fuel Boiler, 90% AFUE

      # min. efficiency ducted fuel furnaces
      - option: HVAC Heating Efficiency|Fuel Furnace, 80% AFUE
        apply_logic:
          - or:
            - Heating Fuel|Natural Gas
            - Heating Fuel|Propane
          - or:
            - HVAC Heating Efficiency|Fuel Furnace, 60% AFUE
            - HVAC Heating Efficiency|Fuel Furnace, 68% AFUE
            - HVAC Heating Efficiency|Fuel Furnace, 72% AFUE
            - HVAC Heating Efficiency|Fuel Furnace, 76% AFUE
            - HVAC Heating Efficiency|Fuel Furnace, 80% AFUE

      - option: HVAC Heating Efficiency|Fuel Furnace, 83% AFUE
        apply_logic:
          - Heating Fuel|Fuel Oil
          - or:
            - HVAC Heating Efficiency|Fuel Furnace, 60% AFUE
            - HVAC Heating Efficiency|Fuel Furnace, 68% AFUE
            - HVAC Heating Efficiency|Fuel Furnace, 72% AFUE
            - HVAC Heating Efficiency|Fuel Furnace, 76% AFUE
            - HVAC Heating Efficiency|Fuel Furnace, 80% AFUE

      - option: HVAC Heating Efficiency|Fuel Furnace, 92.5% AFUE
        apply_logic:
          - HVAC Heating Efficiency|Fuel Furnace, 92.5% AFUE

      # ASHP
      - option: HVAC Heating Efficiency|ASHP, SEER2 14.3, 7.5 HSPF2
        apply_logic:
          - or:
            - HVAC Heating Efficiency|ASHP, SEER 10, 6.2 HSPF
            - HVAC Heating Efficiency|ASHP, SEER 10.3, 7.0 HSPF
            - HVAC Heating Efficiency|ASHP, SEER 11.5, 7.5 HSPF
            - HVAC Heating Efficiency|ASHP, SEER 13, 7.7 HSPF
            - HVAC Heating Efficiency|ASHP, SEER 13, 8.0 HSPF
            - HVAC Heating Efficiency|ASHP, SEER 14, 8.2 HSPF
            - HVAC Heating Efficiency|ASHP, SEER 14.3, 8.5 HSPF
            - HVAC Heating Efficiency|ASHP, SEER 15, 8.5 HSPF #14.3 SEER2 == 15 SEER1, ducted

      ### [2] Cooling Efficiencies
      ## 2.1 Replace like with like
      - option: HVAC Cooling Efficiency|Ducted Heat Pump
        apply_logic:
          - HVAC Cooling Efficiency|Ducted Heat Pump

      # (not applicable because of package_apply_logic)
      # - option: HVAC Cooling Efficiency|Non-Ducted Heat Pump
      #   apply_logic:
      #     - HVAC Cooling Efficiency|Non-Ducted Heat Pump

      ## 2.2 Categories with efficiency change
      # Central AC — SEER 14.3 for southern states only
      - option: HVAC Cooling Efficiency|AC, SEER2 14.3
        apply_logic:
          - and:
            - or:
              - State|AL
              - State|AR
              - State|DE
              - State|FL
              - State|GA
              - State|HI
              - State|KY
              - State|LA
              - State|MD
              - State|MS
              - State|NC
              - State|OK
              - State|SC
              - State|TN
              - State|TX
              - State|VA
              - State|DC
              - State|AZ
              - State|CA
              - State|NV
              - State|NM
          - or:
            - HVAC Cooling Efficiency|AC, SEER 8
            - HVAC Cooling Efficiency|AC, SEER 10
            - HVAC Cooling Efficiency|AC, SEER 13

      # All other states — SEER 13.4
      - option: HVAC Cooling Efficiency|AC, SEER2 13.4
        apply_logic:
          - not:
            - or:
              - State|AL
              - State|AR
              - State|DE
              - State|FL
              - State|GA
              - State|HI
              - State|KY
              - State|LA
              - State|MD
              - State|MS
              - State|NC
              - State|OK
              - State|SC
              - State|TN
              - State|TX
              - State|VA
              - State|DC
              - State|AZ
              - State|CA
              - State|NV
              - State|NM
          - or:
            - HVAC Cooling Efficiency|AC, SEER 8
            - HVAC Cooling Efficiency|AC, SEER 10
            - HVAC Cooling Efficiency|AC, SEER 13

      - option: HVAC Cooling Efficiency|AC, SEER 15
        apply_logic:
          - HVAC Cooling Efficiency|AC, SEER 15

      # Room (window) AC
      - option: HVAC Cooling Efficiency|Room AC, EER 12.0 #CEER 11.0; EER 12.0 single package
        apply_logic:
          - or:
            - HVAC Cooling Efficiency|Room AC, EER 8.5
            - HVAC Cooling Efficiency|Room AC, EER 9.8
            - HVAC Cooling Efficiency|Room AC, EER 10.7
            - HVAC Cooling Efficiency|Room AC, EER 12.0

  ### -- HVAC: Air Source Heat Pumps -- ###
  - upgrade_name: Typical Cold Climate Ducted Air Source Heat Pump Circa 2025
    package_apply_logic: *fossil_fuel_or_electricity
    options:
      - option: HVAC Heating Efficiency|ASHP, SEER2 17.5, 8.5 HSPF2, Typical Cold Climate
        apply_logic: *typical_cold_climate_logic

      - option: HVAC Detailed Performance Data|Cold Climate Heat Pump Ducted
        apply_logic: *typical_cold_climate_logic

      - option: HVAC Cooling Efficiency|Ducted Heat Pump
        apply_logic: *typical_cold_climate_logic

      - option: HVAC Cooling Partial Space Conditioning|100% Conditioned
        apply_logic: *typical_cold_climate_logic

      - option: Heating Fuel|Electricity
        apply_logic:
            and:
              - *typical_cold_climate_logic
              - not: Heating Fuel|Electricity

      - option: HVAC Heating Type And Fuel|Electricity ASHP
        apply_logic:
            and:
              - *typical_cold_climate_logic
              - not: HVAC Heating Type And Fuel|Electricity ASHP

  - upgrade_name: Dual Fuel Heat Pump System
    package_apply_logic: *fossil_fuel_or_electricity
    options:
      - option: HVAC Heating Efficiency|Dual-Fuel ASHP, SEER 15.2, 7.8 HSPF2, Integrated Backup, 95.0% AFUE NG, 35F switchover
        apply_logic: *dual_fuel_system_cold_climate

      - option: HVAC Cooling Efficiency|Ducted Heat Pump
        apply_logic: *dual_fuel_system_cold_climate

      - option: HVAC Cooling Partial Space Conditioning|100% Conditioned
        apply_logic: *dual_fuel_system_cold_climate

      - option: HVAC Heating Efficiency|Dual-Fuel ASHP, SEER 15.2, 7.8 HSPF2, Integrated Backup, 92.5% AFUE NG, 35F switchover
        apply_logic: *dual_fuel_system_warm_climate

      - option: HVAC Cooling Efficiency|Ducted Heat Pump
        apply_logic: *dual_fuel_system_warm_climate

      - option: HVAC Cooling Partial Space Conditioning|100% Conditioned
        apply_logic: *dual_fuel_system_warm_climate

  ### -- HVAC: Geothermal Heat Pumps -- ###
  - upgrade_name: Single-Speed Geothermal Heat Pump with Thermally Enhanced Grout and Pipes
    package_apply_logic: *remove_nonducted_high_rise_shared_low_ground_conductivity
    options:
      - option: HVAC Heating Efficiency|GSHP, EER 18.6, COP 3.8
        apply_logic: *ducted_ashp_apply_logic

      - *heat_pump_cooling_efficiency_ducted
      - *partial_conditioning_100_percent_ducts_only

  - upgrade_name: Dual-Speed Geothermal Heat Pump with Thermally Enhanced Grout and Pipes
    package_apply_logic: *remove_nonducted_high_rise_shared_low_ground_conductivity
    options:
      - *dual_speed_ducted_ghp
      - *heat_pump_cooling_efficiency_ducted
      - *partial_conditioning_100_percent_ducts_only

  - upgrade_name: Variable-Speed Geothermal Heat Pump with Thermally Enhanced Grout and Pipes
    package_apply_logic: *remove_nonducted_high_rise_shared_low_ground_conductivity
    options:
      - option: HVAC Heating Efficiency|GSHP, EER 30.9, COP 4.4
        apply_logic: *ducted_ashp_apply_logic

      - *heat_pump_cooling_efficiency_ducted
      - *partial_conditioning_100_percent_ducts_only

  ### -- Water Heater -- ###
  - upgrade_name: Heat Pump Water Heater
    package_apply_logic: *hpwh_apply_logic
    options:
      - *change_water_heater_fuel_to_electricity
      - *hpwh_50_gal_3_pt_78_uef
      - *hpwh_66_gal_3_pt_95_uef
      - *hpwh_80_gal_3_pt_98_uef

  - upgrade_name: High Efficiency Natural Gas Tankless Water Heater
    package_apply_logic: *high_eff_ng_tankless_wh_apply_logic
    options:
      - *change_water_heater_fuel_to_natural_gas
      - *high_eff_ng_tankless_wh

  ### -- Envelope and Ducts -- ###
  - upgrade_name: Air Sealing
    options:
      - *infiltration_all_cz_sf_mf_mb

  - upgrade_name: Attic Floor Insulation for Unfinished Attics
    options:
      - *attic_insulation_cz1_sf
      - *attic_insulation_cz2_8_sf

  - upgrade_name: Duct Sealing and Insulation
    options:
      - *duct_seal_only_r6
      - *duct_seal_only_r8
      - *duct_seal_and_insulate

  - upgrade_name: Drill and Fill Wall Insulation with Air Sealing
    options:
      - *drill_and_fill_wall_insulation
      - *infiltration_all_cz_sf_mf_mb

  - upgrade_name: Air Sealing, Attic Floor Insulation, and Duct sealing
    options:
      - *infiltration_all_cz_sf_mf_mb
      - *attic_insulation_cz1_sf
      - *attic_insulation_cz2_8_sf
      - *duct_seal_only_r6
      - *duct_seal_only_r8
      - *duct_seal_and_insulate

  - upgrade_name: Air Sealing, Attic Floor Insulation, Duct sealing, and Drill-and-Fill Wall Insulation
    options:
      - *infiltration_all_cz_sf_mf_mb
      - *attic_insulation_cz1_sf
      - *attic_insulation_cz2_8_sf
      - *duct_seal_only_r6
      - *duct_seal_only_r8
      - *duct_seal_and_insulate
      - *drill_and_fill_wall_insulation

  - upgrade_name: ENERGY STAR Windows
    options:
      - *energystar_window_northern
      - *energystar_window_north_central
      - *energystar_window_south_central
      - *energystar_window_southern
      - *infiltration_30pct_reduction_windows
      - *infiltration_13pct_reduction_windows

  ### -- Packages -- ###
  - upgrade_name: Dual-Speed Geothermal Heat Pump with Thermally Enhanced Grout and Pipes, Air Sealing, Attic Floor Insulation, and Duct Sealing
    package_apply_logic: *remove_nonducted_high_rise_shared_low_ground_conductivity
    options:
      ### -- Dual-Speed Ducted GHP -- ###
      - *dual_speed_ducted_ghp
      - *heat_pump_cooling_efficiency_ducted
      - *partial_conditioning_100_percent_ducts_only

      ### --Envelope Package -- ###
      - *infiltration_all_cz_sf_mf_mb
      - *attic_insulation_cz1_sf
      - *attic_insulation_cz2_8_sf
      - *duct_seal_only_r6
      - *duct_seal_only_r8
      - *duct_seal_and_insulate

  ### -- Electric Vehicles -- ###
  - upgrade_name: Electric Vehicle Adoption with Level 1 Charging
    package_apply_logic:
      - Electric Vehicle Ownership|No
      - *occupied_only
    options:
      - *ev_ownership_yes
      - option: Electric Vehicle Charger|Level 1 charger

  - upgrade_name: Electric Vehicle Adoption with Level 2 Charging
    package_apply_logic: *occupied_only
    options:
      - *ev_ownership_yes
      - *ev_l2_charger

  - upgrade_name: Efficient Electric Vehicle Adoption with Level 2 Charging
    package_apply_logic: *occupied_only
    options:
      - *ev_ownership_yes
      - *ev_l2_charger
      - *ev_15_percent_efficiency

  ### -- Electric Vehicles Demand Flexibility -- ###
  - upgrade_name: Electric Vehicle Adoption with Level 2 Charging and Demand Flexibility
    package_apply_logic: *occupied_only
    options:
      - *ev_ownership_yes
      - *ev_l2_charger
      - *demand_flexibility_electric_vehicle
      - *demand_flexibility_30_minute_random_shift

  - upgrade_name: Efficient Electric Vehicle Adoption with Level 2 Charging and Demand Flexibility
    package_apply_logic: *occupied_only
    options:
      - *ev_ownership_yes
      - *ev_l2_charger
      - *ev_15_percent_efficiency
      - *demand_flexibility_electric_vehicle
      - *demand_flexibility_30_minute_random_shift

  ### -- Thermostat Demand Flexibility -- ###
  - upgrade_name: HVAC Demand Flexibility - On-peak Load Shedding, 2F Offset
    package_apply_logic: *has_cooling_or_heating
    options:
      - option: Demand Flexibility HVAC|On-peak Load Shedding, 2F Offset
      - *demand_flexibility_30_minute_random_shift

  - upgrade_name: HVAC Demand Flexibility - Pre-peak Load Shifting, 2F Offset, 4hr Pre-peak Duration
    package_apply_logic: *has_cooling_or_heating
    options:
      - option: Demand Flexibility HVAC|Pre-peak Load Shifting, 2F Offset, 4hr Pre-peak Duration
      - *demand_flexibility_30_minute_random_shift

  - upgrade_name: HVAC Demand Flexibility - On-peak Load Shedding, 4F Offset
    package_apply_logic: *has_cooling_or_heating
    options:
      - option: Demand Flexibility HVAC|On-peak Load Shedding, 4F Offset
      - *demand_flexibility_30_minute_random_shift

  - upgrade_name: HVAC Demand Flexibility - Pre-peak Load Shifting, 4F Offset, 4hr Pre-peak Duration
    package_apply_logic: *has_cooling_or_heating
    options:
      - option: Demand Flexibility HVAC|Pre-peak Load Shifting, 4F Offset, 4hr Pre-peak Duration
      - *demand_flexibility_30_minute_random_shift

  - upgrade_name: HVAC Demand Flexibility - Pre-peak Load Shifting, 2F Offset, 1hr Pre-peak Duration
    package_apply_logic: *has_cooling_or_heating
    options:
      - option: Demand Flexibility HVAC|Pre-peak Load Shifting, 2F Offset, 1hr Pre-peak Duration
      - *demand_flexibility_30_minute_random_shift
